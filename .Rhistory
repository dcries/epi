str(tstar2)
K
Rcpp::sourceCpp('mcmc_epi_mixture.cpp')
out5 = mcmc_epi_mixture(MetS,tstar2, start, prior, K,2,1,thin=1)
Rcpp::sourceCpp('mcmc_epi_mixture.cpp')
out5 = mcmc_epi_mixture(MetS,tstar2, start, prior, K,2,1,thin=1)
Rcpp::sourceCpp('mcmc_epi_mixture.cpp')
out5 = mcmc_epi_mixture(MetS,tstar2, start, prior, K,2,1,thin=1)
out5 = mcmc_epi_mixture(MetS,tstar2, start, prior, K,20,10,thin=1)
dim(out5$pmat)
pmat <- array(0,dim=c(nrow(out5$beta),nrow(MetS),K))
dim(pmat)
for(i in 1:K){
for(j in 1:nrow(MetS)){
pmat[,j,i] <- out5$pmat[j,i,]
}
}
head(out5$pmat)
head(pmat)
a=label.switching("STEPHENS",z=z,K=2,data=cbind(x1,x2),p=pmat)
dim(p)
dim(pmat)
a=label.switching("STEPHENS",p=pmat)
dim(out5$zeta)
a=label.switching("STEPHENS",p=pmat,z=out5$zeta+1)
summary(a$permutations$STEPHENS)
permutations=label.switching(c("ECR-ITERATIVE-1","ECR_ITERATIVE-2","STEPHENS"),
p=pmat,z=out5$zeta+1,K=K)
permutations=label.switching(c("ECR-ITERATIVE-1","ECR-ITERATIVE-2","STEPHENS"),
p=pmat,z=out5$zeta+1,K=K)
150000/10
library(Rcpp)
library(MASS)
library(mvtnorm)
library(LaplacesDemon)
library(dplyr)
library(label.switching)
getwd()
imp1 <- read.csv("nhanes_complete.csv")
load("../../workspace2/stanout2.RData")
load("../../workspace2/stanout.RData")
rs
rmat <- as.matrix(rs)
dim(rmat)
names(imp1) <- tolower(names(imp1))
imp1 <- subset(imp1,rep!=7)
nrep <- (imp1 %>% group_by(id) %>% summarise(n=length(id)))$n
length(unique(imp1$id))
nrep <- (imp1 %>% group_by(id) %>% summarise(n=length(id)))$n
meas7 <- subset(imp1, id %in% unique(id)[nrep==6] & (!is.na(imp1$education))) #individuals with all 7 days
length(unique(meas7$id))
rs
dim(rmat)
tstar <- rmat[,31:3367]
dim(tstar)
length(unique(imp1$id))
length(unique(meas7$id))
tstar2 <- tstar[,complete.cases(meas7[!duplicated(meas7$id),]) & (meas7$bpd[!duplicated(meas7$id)] > 0)]
dim(tstar2)
dim(tstar)
meas7 <- subset(imp1, id %in% unique(id)[nrep==6] & (!is.na(imp1$education))) #individuals with all 7 days
tstar2 <- tstar[,complete.cases(meas7[!duplicated(meas7$id),]) & (meas7$bpd[!duplicated(meas7$id)] > 0)]
dim(tstar2)
meas7 <- meas7[(!is.na(meas7$waist)) & (!is.na(meas7$bps)) & (!is.na(meas7$bpd)) & (!is.na(meas7$hdl)) & (!is.na(meas7$ldl)) & (!is.na(meas7$glu)) & (!is.na(meas7$tri)) & (!is.na(meas7$education)) & (meas7$bpd >0),] #remove NAs for waist
dim(meas7)
length(unique(meas7$id))
dim(tstar)
length(unique(meas7$id))
meas7 <- subset(imp1, id %in% unique(id)[nrep==6] & (!is.na(imp1$education))) #individuals with all 7 days
tstar2 <- tstar[,complete.cases(meas7[!duplicated(meas7$id),]) & (meas7$bpd[!duplicated(meas7$id)] > 0)]
dim(tstar2)
head(tstar2)
dim(tstar)
dim(tstar2)
complete.cases(meas7[!duplicated(meas7$id),]) & (meas7$bpd[!duplicated(meas7$id)] > 0)
sum(complete.cases(meas7[!duplicated(meas7$id),]) & (meas7$bpd[!duplicated(meas7$id)] > 0))
dim(meas7)
names(meas7)
tstar2 <- tstar[,(!is.na(meas7$waist)) & (!is.na(meas7$bps)) & (!is.na(meas7$bpd)) & (!is.na(meas7$hdl)) & (!is.na(meas7$ldl)) & (!is.na(meas7$glu)) & (!is.na(meas7$tri)) & (!is.na(meas7$education)) & (meas7$bpd >0)]
tstar2 <- tstar[,(!is.na(meas7$waist)) & (!is.na(meas7$bps)) & (!is.na(meas7$bpd)) & (!is.na(meas7$hdl)) & (!is.na(meas7$ldl)) & (!is.na(meas7$glu)) & (!is.na(meas7$tri)) & (!is.na(meas7$education)) & (meas7$bpd >0)]
(!is.na(meas7$waist))
(!is.na(meas7$waist)) & (!is.na(meas7$bps)) & (!is.na(meas7$bpd)) & (!is.na(meas7$hdl)) & (!is.na(meas7$ldl)) & (!is.na(meas7$glu)) & (!is.na(meas7$tri)) & (!is.na(meas7$education))
(meas7$bpd >0)
(!is.na(meas7$waist)) & (!is.na(meas7$bps)) & (!is.na(meas7$bpd)) & (!is.na(meas7$hdl)) & (!is.na(meas7$ldl)) & (!is.na(meas7$glu)) & (!is.na(meas7$tri)) & (!is.na(meas7$education)) & (meas7$bpd >0)
dim(tstar)
dim(meas6)
dim(meas7)
dim(tstar)
meas7 <- subset(imp1, id %in% unique(id)[nrep==6] & (!is.na(imp1$education))) #individuals with all 7 days
lenghth(unique(meas7$id))
length(unique(meas7$id))
3337*6
dim(meas7)
dim(tstar)
length(unique(meas7$id))
names(meas7)
tstar2 <- tstar[,complete.cases(meas7[!duplicated(meas7$id),c("waist","glu","tri","bps","bpd","ldl","hdl")]) & (meas7$bpd[!duplicated(meas7$id)] > 0)]
dim(tstar2)
meas7 <- meas7[(!is.na(meas7$waist)) & (!is.na(meas7$bps)) & (!is.na(meas7$bpd)) & (!is.na(meas7$hdl)) & (!is.na(meas7$ldl)) & (!is.na(meas7$glu)) & (!is.na(meas7$tri)) & (!is.na(meas7$education)) & (meas7$bpd >0),] #remove NAs for waist
length(unique(meas7$id))
sum(is.na(meas7$bmi))
setwd("C:\\Users\\dcries\\github\\epi")
nhanes <- read.csv("NHANES_complete.csv")
names(nhanes) <- tolower(names(nhanes))
nhanes$a <- 1;nhanes$a[nhanes$age>=35] <- 2;nhanes$a[nhanes$age>=50] <- 3;nhanes$a[nhanes$age>=65] <- 4
nhanes$weekend <- 0
nhanes$weekend[nhanes$dow %in% c(1,7)] <- 1
nhanes$first5 <- 0
nhanes$first5[nhanes$rep==6] <- 1
nhanes$first5[nhanes$rep==7] <- 2
nhanes <- subset(nhanes,rep!=7)
m1 <- lm(modvigmin~(weekend)+first5,data=nhanes)
wbar <- mean((nhanes$modvigmin[nhanes$rep <= 5]))
w1 <- nhanes$modvigmin
what <- predict(m1)
w <- (1/what)*w1*wbar
nhanes$w <- w^.25
#for variance
nhanes2 <- subset(nhanes,w>0)
d = nhanes2 %>% group_by(id) %>% summarise(m=mean(w),glu=glu[1],waist=waist[1],tri=tri[1],bps=bps[1],bpd=bpd[1],hdl=hdl[1],ldl=ldl[1],n=length(w))
mfull <- lme(w~age+as.factor(race)+as.factor(sex),data=nhanes2,random=~1|id,correlation=corAR1(form=~1|id),method="REML")
rf <- NULL
rfs <- unlist(ranef(mfull))
for(i in 1:length(unique(nhanes2$id))){
rf <- c(rf,rep(rfs[i],d$n[i]))
}
nhanes2$w2 <- nhanes2$w - predict(mfull) - rf
agevar=nhanes2 %>% group_by(age) %>% summarise(v=var(w2))
library(ggplot2)
library(lme4)
library(dplyr)
library(reshape)
library(car)
library(nlme)
nhanes2 <- subset(nhanes,w>0)
d = nhanes2 %>% group_by(id) %>% summarise(m=mean(w),glu=glu[1],waist=waist[1],tri=tri[1],bps=bps[1],bpd=bpd[1],hdl=hdl[1],ldl=ldl[1],n=length(w))
mfull <- lme(w~age+as.factor(race)+as.factor(sex),data=nhanes2,random=~1|id,correlation=corAR1(form=~1|id),method="REML")
rf <- NULL
rfs <- unlist(ranef(mfull))
for(i in 1:length(unique(nhanes2$id))){
rf <- c(rf,rep(rfs[i],d$n[i]))
}
nhanes2$w2 <- nhanes2$w - predict(mfull) - rf
agevar=nhanes2 %>% group_by(age) %>% summarise(v=var(w2))
names(nhanes2)
names(nhanes)
nhanes2$b <- 1;nhanes2$b[a1$bmi>=18] <- 2;nhanes2$b[a1$bmi>=25] <- 3;nhanes2$b[nhanes2$bmi>=30] <- 4;nhanes2$b[nhanes2$bmi>=35] <- 5
nhanes2$b <- 1;nhanes2$b[nhanes2$bmi>=18] <- 2;nhanes2$b[nhanes2$bmi>=25] <- 3;nhanes2$b[nhanes2$bmi>=30] <- 4;nhanes2$b[nhanes2$bmi>=35] <- 5
mm <- lme(w~1,data=subset(nhanes2,sex==1),random=~1|id,correlation=corAR1(form=~1|id),method="ML")
mf <- lme(w~age+as.factor(race),data=subset(nhanes2,sex==2),random=~1|id,correlation=corAR1(form=~1|id),method="ML")
mm
mf
mb1 <- lme(w~1,data=subset(nhanes2,b==1),random=~1|id,correlation=corAR1(form=~1|id),method="ML")
mb2 <- lme(w~1,data=subset(nhanes2,b==2),random=~1|id,correlation=corAR1(form=~1|id),method="ML")
mb3 <- lme(w~1,data=subset(nhanes2,b==3),random=~1|id,correlation=corAR1(form=~1|id),method="ML")
mb4 <- lme(w~1,data=subset(nhanes2,b==4),random=~1|id,correlation=corAR1(form=~1|id),method="ML")
mb5 <- lme(w~1,data=subset(nhanes2,b==5),random=~1|id,correlation=corAR1(form=~1|id),method="ML")
mb1
mb2
mb3
mb4
mb5
126+57+48+65
295/1057
126/1057
load("C:/Users/dcries/workspace2/stanout_mix5.RData")
out5$dic
names(out5)
dim(out5)
out5[[1]]$dic
summary(out5[[1]]$pi)
load("C:/Users/dcries/workspace2/stanout_realmix6.RData")
summary(out6$pi)
load("C:/Users/dcries/workspace2/stanout_mix5.RData")
out5[[1]]$dic
summary(out5[[1]]$pi)
out5[[2]]$timings
out5[[2]]$similarity
dim(out5[[2]]$permutations)
class(out5[[2]]$permutations)
dim(out5[[2]]$permutations$`ECR-ITERATIVE-1`)
colMeans(out5[[2]]$permutations$`ECR-ITERATIVE-1`)
colMeans(out5[[2]]$permutations$`ECR-ITERATIVE-2`)
colMeans(out5[[2]]$permutations$STEPHENS)
out5=out5[[1]]
out=out5
name=c("w","G","t","bps","ldl","bpd","hdl")
par(mfrow=c(3,2))
for(i in 1:7){
for(j in 1:6){
if(j==6){
plot.new()
}
else{
plot((out$lambda[,i,j]),type="l",main=name[i]) #w
}
}
}
for(i in 1:7){
for(j in 1:6){
if(j==6){
plot.new()
}
else{
plot((out$lambda[,i,j]),type="l",main=name[i]) #w
}
}
}
load("C:/Users/dcries/workspace2/stanout_mix5.RData")
dim(out5[[2]]$permutations$`ECR-ITERATIVE-2`)
head(out5[[2]]$permutations$`ECR-ITERATIVE-2`)
tail(out5[[2]]$permutations$`ECR-ITERATIVE-2`)
tail(out5[[2]]$permutations$`ECR-ITERATIVE-1`)
tail(out5[[2]]$clusters)
dim(out5[[2]]$clusters)
head(t(out5[[2]]$clusters))
tail(t(out5[[2]]$clusters))
head(out5[[2]]$permutations$`ECR-ITERATIVE-2`)
(out5[[2]]$permutations$`ECR-ITERATIVE-2`)[4000:4600,]
(out5[[2]]$permutations$`ECR-ITERATIVE-2`)[4200:4600,]
length(unique(nhanes$id))
4038+4206
setwd("C:\\Users\\dcries\\github\\epi")
nhanes <- read.csv("NHANES_complete.csv")
names(nhanes) <- tolower(names(nhanes))
length(unique(nhanes$id))
sum(nhanes[!duplicated(nhanes$id),"bmi"]<18)
out=out5
plot(out$beta[,1],type="l") #waist decrease
plot(out$beta[,1],type="l") #waist decrease
names(out)
names(out5)
out=out5[[1]]
plot(out$beta[,1],type="l") #waist decrease
dev.off()
plot(out$beta[,1],type="l") #waist decrease
plot(out$beta[,2],type="l") #waist k
plot(out$beta[,3],type="l") #waist midpoint
plot(out$beta[,4],type="l") #glu decrease
plot(out$beta[,5],type="l") #glu k
plot(out$beta[,6],type="l") #glu midpoint
plot(out$beta[,7],type="l") #tri decrease
plot(out$beta[,8],type="l") #tri k
plot(out$beta[,9],type="l") #tri mid
plot(out$beta[,10],type="l") #bps decrease
plot(out$beta[,11],type="l") #bps k
plot(out$beta[,12],type="l") #bps mid
plot(out$beta[,13],type="l") #ldl
plot(out$beta[,14],type="l") #bpd
plot(out$beta[,15],type="l") #hdl
nhanes$weekend <- 0
nhanes$weekend[nhanes$dow %in% c(1,7)] <- 1
nhanes$first5 <- 0
nhanes$first5[nhanes$rep==6] <- 1
nhanes$first5[nhanes$rep==7] <- 2
nhanes$active <- 1
nhanes$active[nhanes$modvigmin ==0] <- 0
nhanes <- subset(nhanes,rep!=7)
m1 <- lm(modvigmin^.25~(weekend)+first5,data=nhanes)
wbar <- mean((nhanes$modvigmin[nhanes$rep <= 5])^.25)
w1 <- nhanes$modvigmin^.25
what <- predict(m1)
w <- (1/what)*w1*wbar
nhanes$modvigmin2 <- w
indlevel <- nhanes %>% group_by(id) %>% summarise(m=mean(modvigmin^(1/4)),m2=mean(modvigmin2),s=sd(modvigmin^(1/4)),glu=glu[1],waist=waist[1],ldl=ldl[1],hdl=hdl[1],bps=bps[1],bpd=bpd[1],tri=tri[1],gender=sex[1],race=race[1],age=age[1],n=length(id))
indlevel$agegroup <- 1;indlevel$agegroup[indlevel$age>29] <- 2;indlevel$agegroup[indlevel$age>45] <- 3;indlevel$agegroup[indlevel$age>63] <- 4;
p1 <- qplot(data=indlevel,x=m,y=log(glu))+ylab("log Glucose") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
p2 <- qplot(data=indlevel,x=m,y=waist)+ylab("Waist") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
p3 <- qplot(data=indlevel,x=m,y=log(tri))+ylab("log Triglycerides") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
p4 <- qplot(data=indlevel,x=m,y=ldl)+ylab("LDL") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
p5 <- qplot(data=indlevel,x=m,y=hdl)+ylab("HDL") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
p6 <- qplot(data=indlevel,x=m,y=bps)+ylab("Blood Pressure (S)") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
p7 <- qplot(data=indlevel,x=m,y=bpd)+ylab("Blood Pressure (D)") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
grid.arrange(p1,p2,p3,p4,p5,p6,p7,nrow=4)
p1 <- qplot(data=indlevel,x=m,y=(glu))+ylab("Glucose") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
p2 <- qplot(data=indlevel,x=m,y=waist)+ylab("Waist") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
p3 <- qplot(data=indlevel,x=m,y=(tri))+ylab("Triglycerides") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
p4 <- qplot(data=indlevel,x=m,y=ldl)+ylab("LDL") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
p5 <- qplot(data=indlevel,x=m,y=hdl)+ylab("HDL") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
p6 <- qplot(data=indlevel,x=m,y=bps)+ylab("Blood Pressure (S)") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
p7 <- qplot(data=indlevel,x=m,y=bpd)+ylab("Blood Pressure (D)") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()
grid.arrange(p1,p2,p3,p4,p5,p6,p7,nrow=4)
p1 <- qplot(data=indlevel,x=m,y=(glu))+ylab("Glucose") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw()+ ylim(c(0,400))
p3 <- qplot(data=indlevel,x=m,y=(tri))+ylab("Triglycerides") + xlab("Mean Transformed MVPA Minutes") + geom_smooth() + theme_bw() + ylim(c(0,1000))
grid.arrange(p1,p2,p3,p4,p5,p6,p7,nrow=4)
m1
summary(weekend)
summary(m1)
nhanes2 <- subset(nhanes,w>0)
d = nhanes2 %>% group_by(id) %>% summarise(m=mean(w),glu=glu[1],waist=waist[1],tri=tri[1],bps=bps[1],bpd=bpd[1],hdl=hdl[1],ldl=ldl[1],n=length(w))
mfull <- lme(w~age+as.factor(race)+as.factor(sex),data=nhanes2,random=~1|id,correlation=corAR1(form=~1|id),method="REML")
names(nhanes) <- tolower(names(nhanes))
nhanes$a <- 1;nhanes$a[nhanes$age>=35] <- 2;nhanes$a[nhanes$age>=50] <- 3;nhanes$a[nhanes$age>=65] <- 4
nhanes$weekend <- 0
nhanes$weekend[nhanes$dow %in% c(1,7)] <- 1
nhanes$first5 <- 0
nhanes$first5[nhanes$rep==6] <- 1
nhanes$first5[nhanes$rep==7] <- 2
nhanes <- subset(nhanes,rep!=7)
m1 <- lm(modvigmin~(weekend)+first5,data=nhanes)
wbar <- mean((nhanes$modvigmin[nhanes$rep <= 5]))
w1 <- nhanes$modvigmin
what <- predict(m1)
w <- (1/what)*w1*wbar
nhanes$w <- w^.25
nhanes2 <- subset(nhanes,w>0)
d = nhanes2 %>% group_by(id) %>% summarise(m=mean(w),glu=glu[1],waist=waist[1],tri=tri[1],bps=bps[1],bpd=bpd[1],hdl=hdl[1],ldl=ldl[1],n=length(w))
mfull <- lme(w~age+as.factor(race)+as.factor(sex),data=nhanes2,random=~1|id,correlation=corAR1(form=~1|id),method="REML")
rf <- NULL
rfs <- unlist(ranef(mfull))
for(i in 1:length(unique(nhanes2$id))){
rf <- c(rf,rep(rfs[i],d$n[i]))
}
nhanes2$w2 <- nhanes2$w - predict(mfull) - rf
agevar=nhanes2 %>% group_by(age) %>% summarise(v=var(w2))
m1 <- lm(v~age+I(age^2)+I(age^3),data=agevar)
summary(m1)
load("C:/Users/dcries/workspace2/stanout_realmix7.RData")
out7[[1]]$dic
summary(out7[[1]]$pi)
out7[[2]]$similarity
colMeans(out7[[2]]$permutations$`ECR-ITERATIVE-1`)
colMeans(out7[[2]]$permutations$`ECR-ITERATIVE-2`)
colMeans(out7[[2]]$permutations$STEPHENS)
load("C:/Users/dcries/workspace2/stanout_realmix6.RData")
summary(out6[[1]]$pi)
summary(out6$pi)
load("C:/Users/dcries/workspace2/stanout_realmix4.RData")
summary(out4$pi)
load("C:/Users/dcries/workspace2/stanout_realmix3.RData")
summary(out3$pi)
out=out3
plot(out$beta[,1],type="l") #waist decrease
plot(out$beta[,2],type="l") #waist k
plot(out$beta[,3],type="l") #waist midpoint
plot(out$beta[,4],type="l") #glu decrease
plot(out$beta[,5],type="l") #glu k
plot(out$beta[,6],type="l") #glu midpoint
plot(out$beta[,7],type="l") #tri decrease
plot(out$beta[,8],type="l") #tri k
plot(out$beta[,9],type="l") #tri mid
plot(out$beta[,10],type="l") #bps decrease
plot(out$beta[,11],type="l") #bps k
plot(out$beta[,12],type="l") #bps mid
plot(out$beta[,13],type="l") #ldl
plot(out$beta[,14],type="l") #bpd
plot(out$beta[,15],type="l") #hdl
out=out6
plot(out$beta[,13],type="l") #ldl
out=ou3
out=out3
plot(out$beta[,13],type="l") #ldl
out=out6
plot(out$beta[,1],type="l") #waist decrease
load("C:/Users/dcries/workspace2/stanout_realmix4.RData")
summary(out4[[1]]$pi)
load("C:/Users/dcries/workspace2/stanout_mix8.RData")
out8[[1]]$pi
summary(out8[[1]]$pi)
load("C:/Users/dcries/workspace2/stanout_mix6.RData")
summary(out6[[1]]$pi)
(out6[[2]]$similarity)
colMeans(out6[[2]]$permutations$`ECR-ITERATIVE-1`)
colMeans(out6[[2]]$permutations$`ECR-ITERATIVE-2`)
colMeans(out6[[2]]$permutations$STEPHENS)
colMeans(out4[[1]]$beta)
colMeans(out6[[1]]$beta)
out=out4[[1]]
plot(out$beta[,1],type="l") #waist decrease
plot(out$beta[,2],type="l") #waist k
plot(out6[[1]]$beta[,2],type="l") #waist k
plot(out8[[1]]$beta[,2],type="l") #waist k
plot(out6[[1]]$beta[,13],type="l") #waist k
plot(out4[[1]]$beta[,13],type="l") #waist k
out=out4[[1]]
indmeans <- nhanes %>% group_by(id) %>% summarise(m=mean(w),glu=glu[1],waist=waist[1],
tri=tri[1],bps=bps[1],bpd=bpd[1],hdl=hdl[1],ldl=ldl[1],n=length(w))
x <- seq(from=0,to=4,by=0.1)
waist <- mean(out$lambda[,1,5])-mean(out$beta[,1])/(1+exp(-mean(out$beta[,2])*(x-mean(out$beta[,3]))))
glu <- mean(out$lambda[,2,5])-mean(out$beta[,4])/(1+exp(-mean(out$beta[,5])*(x-mean(out$beta[,6]))))
tri <- mean(out$lambda[,3,5])-mean(out$beta[,7])/(1+exp(-mean(out$beta[,8])*(x-mean(out$beta[,9]))))
bps <- mean(out$lambda[,4,5])-mean(out$beta[,10])/(1+exp(-mean(out$beta[,11])*(x-mean(out$beta[,12]))))
bpd <- mean(out$lambda[,6,5]) + mean(out$beta[,14])*x #+ mean(out$beta[,22])*x^2
ldl <- mean(out$lambda[,5,5]) + mean(out$beta[,13])*x #+ mean(out$beta[,15])*x^2
hdl <- mean(out$lambda[,7,5]) + mean(out$beta[,15])*x
summary(out$pi)
waist <- mean(out$lambda[,1,1])-mean(out$beta[,1])/(1+exp(-mean(out$beta[,2])*(x-mean(out$beta[,3]))))
glu <- mean(out$lambda[,2,1])-mean(out$beta[,4])/(1+exp(-mean(out$beta[,5])*(x-mean(out$beta[,6]))))
tri <- mean(out$lambda[,3,1])-mean(out$beta[,7])/(1+exp(-mean(out$beta[,8])*(x-mean(out$beta[,9]))))
bps <- mean(out$lambda[,4,1])-mean(out$beta[,10])/(1+exp(-mean(out$beta[,11])*(x-mean(out$beta[,12]))))
bpd <- mean(out$lambda[,6,1]) + mean(out$beta[,14])*x #+ mean(out$beta[,22])*x^2
ldl <- mean(out$lambda[,5,1]) + mean(out$beta[,13])*x #+ mean(out$beta[,15])*x^2
hdl <- mean(out$lambda[,7,1]) + mean(out$beta[,15])*x
naivewaist <- naivemeans[4]-naivemeans[1]/(1+exp(-naivemeans[2]*(x-naivemeans[3])))
naiveglu <- naivemeans[8]-naivemeans[5]/(1+exp(-naivemeans[6]*(x-naivemeans[7])))
naivetri <- naivemeans[12]-naivemeans[9]/(1+exp(-naivemeans[10]*(x-naivemeans[11])))
naivebps <- naivemeans[19]-naivemeans[16]/(1+exp(-naivemeans[17]*(x-naivemeans[18])))
naivebpd <- naivemeans[20] + naivemeans[21]*x + naivemeans[22]*x^2
naiveldl <- naivemeans[13] + naivemeans[14]*x + naivemeans[15]*x^2
naivehdl <- naivemeans[23] + naivemeans[24]*x
p1=ggplot() + geom_point(data=indmeans,aes(x=m,y=waist))  + geom_line(aes(x=x,y=naivewaist),colour="red",size=2,linetype=2)+ geom_line(aes(x=x,y=waist),colour="blue",size=2) + theme_bw()
p2=ggplot() + geom_point(data=indmeans,aes(x=m,y=log(glu)))  + geom_line(aes(x=x,y=naiveglu),colour="red",size=2,linetype=2)+ geom_line(aes(x=x,y=glu),colour="blue",size=2) + theme_bw()
p3=ggplot() + geom_point(data=indmeans,aes(x=m,y=log(tri))) + geom_line(aes(x=x,y=naivetri),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=tri),colour="blue",size=2) + theme_bw()
p4=ggplot() + geom_point(data=indmeans,aes(x=m,y=(bps))) + geom_line(aes(x=x,y=naivebps),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=bps),colour="blue",size=2) + theme_bw()
p5=ggplot() + geom_point(data=indmeans,aes(x=m,y=bpd))  + geom_line(aes(x=x,y=naivebpd),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=bpd),colour="blue",size=2)+ theme_bw()
p6=ggplot() + geom_point(data=indmeans,aes(x=m,y=(ldl)))  + geom_line(aes(x=x,y=naiveldl),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=ldl),colour="blue",size=2)+ theme_bw()
p7=ggplot() + geom_point(data=indmeans,aes(x=m,y=(hdl)))  + geom_line(aes(x=x,y=naivehdl),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=hdl),colour="blue",size=2)+ theme_bw()
grid.arrange(p1,p2,p3,p4,p5,p6,p7,nrow=4)
p1=ggplot() + geom_point(data=indmeans,aes(x=m,y=waist))  + geom_line(aes(x=x,y=naivewaist),colour="red",size=2,linetype=2)+ geom_line(aes(x=x,y=waist),colour="blue",size=2) + theme_bw()
p2=ggplot() + geom_point(data=indmeans,aes(x=m,y=(glu)))  + geom_line(aes(x=x,y=naiveglu),colour="red",size=2,linetype=2)+ geom_line(aes(x=x,y=glu),colour="blue",size=2) + theme_bw()
p3=ggplot() + geom_point(data=indmeans,aes(x=m,y=(tri))) + geom_line(aes(x=x,y=naivetri),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=tri),colour="blue",size=2) + theme_bw()
p4=ggplot() + geom_point(data=indmeans,aes(x=m,y=(bps))) + geom_line(aes(x=x,y=naivebps),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=bps),colour="blue",size=2) + theme_bw()
p5=ggplot() + geom_point(data=indmeans,aes(x=m,y=bpd))  + geom_line(aes(x=x,y=naivebpd),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=bpd),colour="blue",size=2)+ theme_bw()
p6=ggplot() + geom_point(data=indmeans,aes(x=m,y=(ldl)))  + geom_line(aes(x=x,y=naiveldl),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=ldl),colour="blue",size=2)+ theme_bw()
p7=ggplot() + geom_point(data=indmeans,aes(x=m,y=(hdl)))  + geom_line(aes(x=x,y=naivehdl),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=hdl),colour="blue",size=2)+ theme_bw()
grid.arrange(p1,p2,p3,p4,p5,p6,p7,nrow=4)
out=out6[[1]]
waist <- mean(out$lambda[,1,1])-mean(out$beta[,1])/(1+exp(-mean(out$beta[,2])*(x-mean(out$beta[,3]))))
glu <- mean(out$lambda[,2,1])-mean(out$beta[,4])/(1+exp(-mean(out$beta[,5])*(x-mean(out$beta[,6]))))
tri <- mean(out$lambda[,3,1])-mean(out$beta[,7])/(1+exp(-mean(out$beta[,8])*(x-mean(out$beta[,9]))))
bps <- mean(out$lambda[,4,1])-mean(out$beta[,10])/(1+exp(-mean(out$beta[,11])*(x-mean(out$beta[,12]))))
bpd <- mean(out$lambda[,6,1]) + mean(out$beta[,14])*x #+ mean(out$beta[,22])*x^2
ldl <- mean(out$lambda[,5,1]) + mean(out$beta[,13])*x #+ mean(out$beta[,15])*x^2
hdl <- mean(out$lambda[,7,1]) + mean(out$beta[,15])*x
p1=ggplot() + geom_point(data=indmeans,aes(x=m,y=waist))  + geom_line(aes(x=x,y=naivewaist),colour="red",size=2,linetype=2)+ geom_line(aes(x=x,y=waist),colour="blue",size=2) + theme_bw()
p2=ggplot() + geom_point(data=indmeans,aes(x=m,y=(glu)))  + geom_line(aes(x=x,y=naiveglu),colour="red",size=2,linetype=2)+ geom_line(aes(x=x,y=glu),colour="blue",size=2) + theme_bw()
p3=ggplot() + geom_point(data=indmeans,aes(x=m,y=(tri))) + geom_line(aes(x=x,y=naivetri),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=tri),colour="blue",size=2) + theme_bw()
p4=ggplot() + geom_point(data=indmeans,aes(x=m,y=(bps))) + geom_line(aes(x=x,y=naivebps),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=bps),colour="blue",size=2) + theme_bw()
p5=ggplot() + geom_point(data=indmeans,aes(x=m,y=bpd))  + geom_line(aes(x=x,y=naivebpd),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=bpd),colour="blue",size=2)+ theme_bw()
p6=ggplot() + geom_point(data=indmeans,aes(x=m,y=(ldl)))  + geom_line(aes(x=x,y=naiveldl),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=ldl),colour="blue",size=2)+ theme_bw()
p7=ggplot() + geom_point(data=indmeans,aes(x=m,y=(hdl)))  + geom_line(aes(x=x,y=naivehdl),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=hdl),colour="blue",size=2)+ theme_bw()
grid.arrange(p1,p2,p3,p4,p5,p6,p7,nrow=4)
load("C:/Users/dcries/workspace/stanout_mix5.RData")
out=out5
waist <- mean(out$lambda[,1,1])-mean(out$beta[,1])/(1+exp(-mean(out$beta[,2])*(x-mean(out$beta[,3]))))
glu <- mean(out$lambda[,2,1])-mean(out$beta[,4])/(1+exp(-mean(out$beta[,5])*(x-mean(out$beta[,6]))))
tri <- mean(out$lambda[,3,1])-mean(out$beta[,7])/(1+exp(-mean(out$beta[,8])*(x-mean(out$beta[,9]))))
bps <- mean(out$lambda[,4,1])-mean(out$beta[,10])/(1+exp(-mean(out$beta[,11])*(x-mean(out$beta[,12]))))
bpd <- mean(out$lambda[,6,1]) + mean(out$beta[,14])*x #+ mean(out$beta[,22])*x^2
ldl <- mean(out$lambda[,5,1]) + mean(out$beta[,13])*x #+ mean(out$beta[,15])*x^2
hdl <- mean(out$lambda[,7,1]) + mean(out$beta[,15])*x
p1=ggplot() + geom_point(data=indmeans,aes(x=m,y=waist))  + geom_line(aes(x=x,y=naivewaist),colour="red",size=2,linetype=2)+ geom_line(aes(x=x,y=waist),colour="blue",size=2) + theme_bw()
p2=ggplot() + geom_point(data=indmeans,aes(x=m,y=log(glu)))  + geom_line(aes(x=x,y=naiveglu),colour="red",size=2,linetype=2)+ geom_line(aes(x=x,y=glu),colour="blue",size=2) + theme_bw()
p3=ggplot() + geom_point(data=indmeans,aes(x=m,y=log(tri))) + geom_line(aes(x=x,y=naivetri),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=tri),colour="blue",size=2) + theme_bw()
p4=ggplot() + geom_point(data=indmeans,aes(x=m,y=(bps))) + geom_line(aes(x=x,y=naivebps),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=bps),colour="blue",size=2) + theme_bw()
p5=ggplot() + geom_point(data=indmeans,aes(x=m,y=bpd))  + geom_line(aes(x=x,y=naivebpd),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=bpd),colour="blue",size=2)+ theme_bw()
p6=ggplot() + geom_point(data=indmeans,aes(x=m,y=(ldl)))  + geom_line(aes(x=x,y=naiveldl),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=ldl),colour="blue",size=2)+ theme_bw()
p7=ggplot() + geom_point(data=indmeans,aes(x=m,y=(hdl)))  + geom_line(aes(x=x,y=naivehdl),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=hdl),colour="blue",size=2)+ theme_bw()
grid.arrange(p1,p2,p3,p4,p5,p6,p7,nrow=4)
summary(out$beta)
colMeans(out$beta)
colMeans(out6[[1]]$beta)
out=out6[[1]]
waist <- mean(out$lambda[,1,1])-mean(out$beta[,1])/(1+exp(-mean(out$beta[,2])*(x-mean(out$beta[,3]))))
glu <- mean(out$lambda[,2,1])-mean(out$beta[,4])/(1+exp(-mean(out$beta[,5])*(x-mean(out$beta[,6]))))
tri <- mean(out$lambda[,3,1])-mean(out$beta[,7])/(1+exp(-mean(out$beta[,8])*(x-mean(out$beta[,9]))))
bps <- mean(out$lambda[,4,1])-mean(out$beta[,10])/(1+exp(-mean(out$beta[,11])*(x-mean(out$beta[,12]))))
bpd <- mean(out$lambda[,6,1]) + mean(out$beta[,14])*x #+ mean(out$beta[,22])*x^2
ldl <- mean(out$lambda[,5,1]) + mean(out$beta[,13])*x #+ mean(out$beta[,15])*x^2
hdl <- mean(out$lambda[,7,1]) + mean(out$beta[,15])*x
p1=ggplot() + geom_point(data=indmeans,aes(x=m,y=waist))  + geom_line(aes(x=x,y=naivewaist),colour="red",size=2,linetype=2)+ geom_line(aes(x=x,y=waist),colour="blue",size=2) + theme_bw()
p2=ggplot() + geom_point(data=indmeans,aes(x=m,y=(glu)))  + geom_line(aes(x=x,y=naiveglu),colour="red",size=2,linetype=2)+ geom_line(aes(x=x,y=glu),colour="blue",size=2) + theme_bw() + ylim(c(0,400))
p3=ggplot() + geom_point(data=indmeans,aes(x=m,y=(tri))) + geom_line(aes(x=x,y=naivetri),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=tri),colour="blue",size=2) + theme_bw() + ylim(c(0,1000))
p4=ggplot() + geom_point(data=indmeans,aes(x=m,y=(bps))) + geom_line(aes(x=x,y=naivebps),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=bps),colour="blue",size=2) + theme_bw()
p5=ggplot() + geom_point(data=indmeans,aes(x=m,y=bpd))  + geom_line(aes(x=x,y=naivebpd),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=bpd),colour="blue",size=2)+ theme_bw()
p6=ggplot() + geom_point(data=indmeans,aes(x=m,y=(ldl)))  + geom_line(aes(x=x,y=naiveldl),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=ldl),colour="blue",size=2)+ theme_bw()
p7=ggplot() + geom_point(data=indmeans,aes(x=m,y=(hdl)))  + geom_line(aes(x=x,y=naivehdl),colour="red",size=2,linetype=2) + geom_line(aes(x=x,y=hdl),colour="blue",size=2)+ theme_bw()
grid.arrange(p1,p2,p3,p4,p5,p6,p7,nrow=4)
plot(out$beta[,1],type="l") #waist decrease
plot(out$beta[,2],type="l") #waist k
plot(out$beta[,3],type="l") #waist midpoint
plot(out$beta[,4],type="l") #glu decrease
plot(out$beta[,5],type="l") #glu k
plot(out$beta[,6],type="l") #glu midpoint
plot(out$beta[,7],type="l") #tri decrease
plot(out$beta[,8],type="l") #tri k
plot(out$beta[,9],type="l") #tri mid
plot(out$beta[,10],type="l") #bps decrease
plot(out$beta[,11],type="l") #bps k
plot(out$beta[,12],type="l") #bps mid
load("C:/Users/dcries/workspace/stanout_mix5.RData")
out=out5
plot(out$beta[,1],type="l") #waist decrease
plot(out$beta[,2],type="l") #waist k
plot(out$beta[,3],type="l") #waist midpoint
plot(out$beta[,4],type="l") #glu decrease
plot(out$beta[,5],type="l") #glu k
plot(out$beta[,6],type="l") #glu midpoint
plot(out$beta[,7],type="l") #tri decrease
plot(out$beta[,8],type="l") #tri k
plot(out$beta[,9],type="l") #tri mid
plot(out$beta[,10],type="l") #bps decrease
plot(out$beta[,11],type="l") #bps k
plot(out$beta[,12],type="l") #bps mid
plot(out$beta[,13],type="l") #ldl
plot(out$beta[,14],type="l") #bpd
plot(out$beta[,15],type="l") #hdl
load("C:/Users/dcries/workspace2/stanout.RData")
rs
load("C:/Users/dcries/workspace2/stanout_imp1.RData")
rs
load("C:/Users/dcries/workspace2/stanout.RData")
r=as.matrix(rs)
plot(r[,2])
plot(r[,3])
load("C:/Users/dcries/workspace2/stanout_imp1.RData")
r=as.matrix(rs)
plot(r[,2])
plot(r[,2])
23000/3600
231000/3600
70000/3600
